# A template for environment variables.
# Copy this file to `.env` and fill in your specific values.

# --- Backend Service ---
# Port for the backend application to listen on.
PORT=10011
# The Kafka broker's address within the Docker network.
KAFKA_BROKER=kafka:29092
# Comma-separated list of Kafka topics the backend will consume.
KAFKA_TOPICS=oee.alerts,oee.production,oee.status_updates,oee.telemetry
# The consumer group ID for the backend application.
KAFKA_GROUP_ID=oee_consumer_group
# The connection string for the PostgreSQL database.
DATABASE_URL=postgres://postgres:password@timescaledb:5432/iiotdb?sslmode=disable
# An alias for DATABASE_URL, used by some PostgreSQL clients.
PSQL_DSN=postgres://postgres:password@timescaledb:5432/iiotdb?sslmode=disable

# --- PostgreSQL Database ---
# The username for the PostgreSQL database.
POSTGRES_USER=postgres
# The password for the PostgreSQL user.
POSTGRES_PASSWORD=password
# The name of the database to be created.
POSTGRES_DB=iiotdb

# --- Adminer (Database Management Tool) ---
# The default server to connect to in Adminer.
ADMINER_DEFAULT_SERVER=timescaledb

# --- Kafka Broker ---
# The unique ID for this Kafka broker.
KAFKA_BROKER_ID=1
# The unique ID for this Kafka node (used in KRaft mode).
KAFKA_NODE_ID=1
# Roles for this Kafka node (e.g., broker, controller).
KAFKA_PROCESS_ROLES=broker,controller
# The quorum voters for the Kafka controller.
KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka:29093
# The unique cluster ID for the Kafka cluster. You can generate this with 'kafka-storage random-uuid'.
CLUSTER_ID='hJ8n-3N-n_41m_7o5vQ-gW'

# --- Kafka Listener Configuration ---
# Internal listeners for the Kafka broker.
KAFKA_LISTENERS=PLAINTEXT://kafka:29092,CONTROLLER://kafka:29093,PLAINTEXT_HOST://0.0.0.0:9092
# Listeners that are advertised to clients. PLAINTEXT_HOST is for external access.
KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://kafka:29092,PLAINTEXT_HOST://localhost:9092
# Name of the listener used for controller communication.
KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER
# Map of listener names to their security protocols.
KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT

# --- Kafka Topic and Log Configuration ---
# Replication factor for the offsets topic. For a single-node setup, 1 is sufficient.
KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1
# The delay before a consumer group rebalance begins. Setting to 0 speeds up startup.
KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=0
# Replication factor for the transaction state log.
KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1
# Minimum in-sync replicas for the transaction state log.
KAFKA_TRANSACTION_STATE_LOG_MIN_ISR=1
# Enables automatic topic creation when a producer publishes to a non-existent topic.
KAFKA_AUTO_CREATE_TOPICS_ENABLE="true"

# --- Kafka UI ---
# Name for the Kafka cluster in the UI.
KAFKA_CLUSTERS_0_NAME=kafka
# The bootstrap server(s) for Kafka UI to connect to.
KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=kafka:29092
# ZooKeeper connection string. Empty for KRaft mode.
KAFKA_CLUSTERS_0_ZOOKEEPERCONNECT=""
# Enables dynamic configuration updates.
DYNAMIC_CONFIG_ENABLED=true

# --- EMQX (MQTT Broker) ---
# The name of the EMQX node.
EMQX_NODE__NAME=emqx@localhost
# The Erlang cookie for inter-node communication.
EMQX_NODE__COOKIE=emqxsecretcookie
# The data directory for EMQX.
EMQX_NODE__DATA_DIR=/opt/emqx/data

# --- EMQX Listeners ---
# Binding for the standard MQTT TCP listener.
EMQX_LISTENERS__TCP__DEFAULT__BIND=0.0.0.0:1883
# Binding for the MQTT over SSL/TLS listener.
EMQX_LISTENERS__SSL__DEFAULT__BIND=0.0.0.0:8883
# Path to the CA certificate file.
EMQX_LISTENERS__SSL__DEFAULT__CACERTFILE=/opt/emqx/certs/rootCA.crt
# Path to the server certificate file.
EMQX_LISTENERS__SSL__DEFAULT__CERTFILE=/opt/emqx/certs/server.crt
# Path to the server key file.
EMQX_LISTENERS__SSL__DEFAULT__KEYFILE=/opt/emqx/certs/server.key
# TLS verification mode. verify_none means the client doesn't verify the server's certificate.
EMQX_LISTENERS__SSL__DEFAULT__VERIFY=verify_none
# TLS versions to use.
EMQX_LISTENERS__SSL__DEFAULT__VERSIONS='["tlsv1.2","tlsv1.3"]'

# --- EMQX Authentication ---
# Enables anonymous client access.
EMQX_AUTH__ANONYMOUS__ENABLED=true

# --- EMQX Dashboard ---
# Binding for the EMQX dashboard HTTP listener.
EMQX_DASHBOARD__LISTENERS__HTTP__BIND=0.0.0.0:18083
# Default username for the dashboard.
EMQX_DASHBOARD__DEFAULT_USERNAME=admin
# Default password for the dashboard.
EMQX_DASHBOARD__DEFAULT_PASSWORD=public

# --- EMQX MQTT Settings ---
# Whether retained messages are available.
EMQX_MQTT__RETAIN_AVAILABLE=true
# Maximum QoS level allowed.
EMQX_MQTT__MAX_QOS_ALLOWED=2
# Session expiry interval in seconds.
EMQX_MQTT__SESSION_EXPIRY_INTERVAL=7200s
# Maximum number of in-flight messages per session.
EMQX_MQTT__MAX_INFLIGHT=32
# Maximum number of awaiting QoS 1/2 messages.
EMQX_MQTT__MAX_AWAITING_REL=100
# Maximum length of the message queue.
EMQX_MQTT__MAX_MQUEUE_LEN=10000

# --- Device Simulator ---
# The hostname of the MQTT broker.
MQTT_BROKER_HOST=emqx
# The port of the MQTT broker.
MQTT_BROKER_PORT=1883
# Username for MQTT client authentication (if not anonymous).
MQTT_USERNAME=iot_user
# Password for MQTT client authentication.
MQTT_PASSWORD=iot_password
# Path to the CA certificate file for SSL/TLS connections.
CA_CERTS_PATH=/app/emqx_broker/certs/rootCA.crt
# The number of simulated devices to create.
NUM_DEVICES=3
# The interval in seconds for publishing telemetry data.
PUBLISH_INTERVAL_TELEMETRY=3